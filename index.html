<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boom Heroes</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; height: 100%; font-family: Arial, sans-serif; background: #222; overflow: hidden; }
    canvas { display: block; background: none; margin: auto; position: absolute; top: 0; bottom: 0; left: 0; right: 0; border: 5px solid #fff; }
    #ui { position: absolute; top: 10px; left: 10px; color: white; font-size: 18px; z-index: 10; }
    #gameOver {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: red;
      font-size: 36px;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border: 2px solid white;
      z-index: 20;
    }
  </style>
</head>
<body>
<div id="ui">Boom Heroes - 1–4 für Helden, Pfeile bewegen, Leertaste = Spezial, WASD = Schießen</div>
<div id="gameOver">GAME OVER - Seite neu laden zum Neustart</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<audio id="bgMusic" loop autoplay>
  <source src="https://cdn.pixabay.com/download/audio/2022/10/19/audio_78335c9c96.mp3?filename=battle-theme-ambient-122949.mp3" type="audio/mpeg">
</audio>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const gameOverScreen = document.getElementById("gameOver");

const music = document.getElementById("bgMusic");
music.volume = 0.3;

const sfx = new Audio("https://cdn.pixabay.com/download/audio/2022/03/22/audio_d98f38fd7a.mp3?filename=retro-game-powerup-21369.mp3");

const characters = {
  "Max Blaze": { x: 150, y: 100, color: "red", ability: "Punch", hp: 100 },
  "Torchbot": { x: 150, y: 200, color: "orange", ability: "Flame", hp: 100 },
  "Volt Girl": { x: 150, y: 300, color: "purple", ability: "Dash", hp: 100 },
  "Boomimp": { x: 150, y: 400, color: "green", ability: "Boom", hp: 100 }
};

const baseStructures = [
  { x: 40, y: 100, hp: 1000 },
  { x: 40, y: 200, hp: 1000 },
  { x: 40, y: 300, hp: 1000 },
  { x: 40, y: 400, hp: 1000 }
];

let selected = "Max Blaze";
let specialActive = false;
let specialTimer = 0;
const enemies = [];
const effects = [];
const powerups = [];
const bullets = [];
let isGameOver = false;

function spawnEnemy() {
  if (!isGameOver) {
    enemies.push({ x: 800, y: Math.random() * 550 + 25, radius: 20, speed: 1.5, hp: 3 });
  }
}
function spawnPowerup() {
  if (!isGameOver) {
    powerups.push({ x: Math.random() * 700 + 50, y: Math.random() * 500 + 50, radius: 10 });
  }
}

setInterval(spawnEnemy, 2500);
setInterval(spawnPowerup, 8000);

document.addEventListener("keydown", e => {
  if (isGameOver) return;
  const char = characters[selected];
  if (e.key === "ArrowRight" && char.x < 790) char.x += 10;
  if (e.key === "ArrowLeft" && char.x > 100) char.x -= 10;
  if (e.key === "ArrowUp" && char.y > 10) char.y -= 10;
  if (e.key === "ArrowDown" && char.y < 590) char.y += 10;
  if (e.key === "1") selected = "Max Blaze";
  if (e.key === "2") selected = "Torchbot";
  if (e.key === "3") selected = "Volt Girl";
  if (e.key === "4") selected = "Boomimp";
  if (e.key === " ") activateSpecial();
  if (["w", "a", "s", "d"].includes(e.key.toLowerCase())) shootBullet(e.key.toLowerCase());
});

function shootBullet(dir) {
  const char = characters[selected];
  let dx = 0, dy = 0;
  if (dir === "w") dy = -5;
  if (dir === "s") dy = 5;
  if (dir === "a") dx = -5;
  if (dir === "d") dx = 5;
  bullets.push({ x: char.x, y: char.y, dx, dy });
}

function drawCharacter(name, char) {
  ctx.fillStyle = char.color;
  ctx.beginPath();
  ctx.arc(char.x, char.y, 20, 0, Math.PI * 2);
  ctx.fill();
  ctx.fillStyle = "white";
  ctx.fillText(name, char.x - 25, char.y - 35);
  ctx.fillText(`HP: ${char.hp}`, char.x - 25, char.y + 40);
}

function drawBase(base) {
  ctx.fillStyle = "gray";
  ctx.fillRect(base.x - 20, base.y - 20, 40, 40);
  ctx.fillStyle = "white";
  ctx.fillText(`HP: ${base.hp}`, base.x - 25, base.y + 35);
}

function activateSpecial() {
  const char = characters[selected];
  specialActive = true;
  specialTimer = 20;
  effects.push({ x: char.x, y: char.y, type: char.ability, time: 20 });
  sfx.play();
}

function updateEffects() {
  for (let i = effects.length - 1; i >= 0; i--) {
    const eff = effects[i];
    eff.time--;
    ctx.strokeStyle = "white";
    ctx.beginPath();
    ctx.arc(eff.x, eff.y, 50, 0, Math.PI * 2);
    ctx.stroke();
    if (eff.time <= 0) effects.splice(i, 1);
  }
}

function update() {
  for (const name in characters) {
    const char = characters[name];
    if (char.hp > 0) {
      for (let i = powerups.length - 1; i >= 0; i--) {
        const p = powerups[i];
        if (Math.hypot(p.x - char.x, p.y - char.y) < 25 + p.radius) {
          char.hp = Math.min(char.hp + 10, 100);
          powerups.splice(i, 1);
          sfx.play();
        }
      }
    }
  }

  bullets.forEach((b, bi) => {
    b.x += b.dx;
    b.y += b.dy;
    for (let i = enemies.length - 1; i >= 0; i--) {
      const e = enemies[i];
      if (Math.hypot(b.x - e.x, b.y - e.y) < 20) {
        e.hp--;
        bullets.splice(bi, 1);
        if (e.hp <= 0) enemies.splice(i, 1);
        break;
      }
    }
  });

  for (let i = enemies.length - 1; i >= 0; i--) {
    const enemy = enemies[i];
    enemy.x -= enemy.speed;
    for (const name in characters) {
      const char = characters[name];
      if (char.hp > 0 && Math.hypot(enemy.x - char.x, enemy.y - char.y) < 25 + enemy.radius) {
        char.hp--;
      }
    }
    for (const base of baseStructures) {
      if (Math.hypot(enemy.x - base.x, enemy.y - base.y) < 40) {
        base.hp -= 1;
      }
    }
    if (enemy.x < -20) enemies.splice(i, 1);
  }

  const allCharactersDead = Object.values(characters).every(c => c.hp <= 0);
  const allBasesDestroyed = baseStructures.every(b => b.hp <= 0);
  if (allCharactersDead || allBasesDestroyed) {
    isGameOver = true;
    gameOverScreen.style.display = "block";
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (const base of baseStructures) drawBase(base);
  for (const name in characters) drawCharacter(name, characters[name]);

  enemies.forEach(e => {
    ctx.fillStyle = "brown";
    ctx.beginPath();
    ctx.arc(e.x, e.y, 20, 0, Math.PI * 2);
    ctx.fill();
  });

  bullets.forEach(b => {
    ctx.fillStyle = "yellow";
    ctx.beginPath();
    ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
    ctx.fill();
  });

  powerups.forEach(p => {
    ctx.fillStyle = "gold";
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fill();
  });

  updateEffects();

  if (!isGameOver) {
    update();
    requestAnimationFrame(draw);
  }
}

draw();
</script>
</body>
</html>
